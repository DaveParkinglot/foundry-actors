<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Actor Sheet</title>
<style>
body { font-family:"Roboto Condensed", sans-serif; background:#1e1e1e; color:#eee; padding:20px; }
a { color:#6cf; text-decoration:none; }
.actor-sheet img { max-width:200px; display:block; margin-bottom:10px; }
.section { margin-bottom:20px; }
.section h2 { margin-bottom:5px; }
</style>
</head>
<body>
<a href="index.html">‚Üê Back to menu</a>
<div id="actor"></div>

<script>
const params = new URLSearchParams(window.location.search);
const actorName = params.get('actor');
const actorDiv = document.getElementById('actor');

if (!actorName) {
  actorDiv.innerHTML = "<p>No actor selected.</p>";
} else {
  fetch(`foundry-actors/${actorName}.json`)
    .then(res => {
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      return res.json();
    })
    .then(actor => {
      if (!actor || !actor.system) {
        actorDiv.innerHTML = "<p style='color:red;'>Actor JSON missing or invalid!</p>";
        return;
      }

      const imgUrl = actor.img ? `https://selerim.duckdns.org/${actor.img}` : '';

      const abilities = actor.system.abilities || {};
      const skills = actor.system.skills || {};
      const attributes = actor.system.attributes || {};
      const hp = attributes.hp?.value ?? 0;
      const ac = attributes.ac?.value ?? 'N/A';
      const init = attributes.init?.bonus ?? 0;
      const currency = actor.system.currency || {};
      const details = actor.details || {};

      let html = `<div class="actor-sheet">
        <h1>${actor.name || 'Unknown Actor'}</h1>
        ${imgUrl ? `<img src="${imgUrl}">` : ''}`;

      html += `<div class="section"><h2>Abilities</h2><ul>`;
      for (const [key, val] of Object.entries(abilities)) {
        html += `<li><strong>${key.toUpperCase()}:</strong> ${val?.value ?? 'N/A'} ${val?.proficient ? '(Proficient)' : ''}</li>`;
      }
      html += `</ul></div>`;

      html += `<div class="section"><h2>Skills</h2><ul>`;
      for (const [key, val] of Object.entries(skills)) {
        html += `<li><strong>${key.toUpperCase()}:</strong> ${val?.value ?? 'N/A'}</li>`;
      }
      html += `</ul></div>`;

      html += `<div class="section"><h2>Attributes</h2>
        <p><strong>HP:</strong> ${hp}</p>
        <p><strong>AC:</strong> ${ac}</p>
        <p><strong>Initiative:</strong> ${init}</p>
      </div>`;

      html += `<div class="section"><h2>Currency</h2>
        <p>${currency.pp ?? 0} pp, ${currency.gp ?? 0} gp, ${currency.sp ?? 0} sp, ${currency.cp ?? 0} cp</p>
      </div>`;

      html += `<div class="section"><h2>Biography</h2>${system.details.biography?.value ?? ''}</div>`;
      html += `<div class="section"><h2>Character Traits</h2>
        <p><strong>Ideal:</strong> ${system.details.ideal ?? ''}</p>
        <p><strong>Bond:</strong> ${system.details.bond ?? ''}</p>
        <p><strong>Flaw:</strong> ${system.details.flaw ?? ''}</p>
        <p><strong>Alignment:</strong> ${system.details.alignment ?? ''}</p>
      </div>`;

      actorDiv.innerHTML = html;
    })
    .catch(err => {
      actorDiv.innerHTML = `<p style="color:red;">Could not load actor: ${err}</p>`;
      console.error(err);
    });
</script>
</body>
</html>
